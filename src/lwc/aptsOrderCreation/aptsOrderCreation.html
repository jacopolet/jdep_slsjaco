<!--
**********************************************************************
Name: aptsOrderCreation
Date: 06 July 2020
Author: Lavanya
Reference: aptsOrderCreation Aura componant
Change Verison History: 
**********************************************************************
-->
<template>
    <!-- PAGE HEADER -->
   <div class="slds-page-header">
       <!-- LAYOUT GRID -->
       <div class="slds-grid">
           <!-- GRID COL -->
           <div class="slds-col slds-has-flexi-truncate">
           <!-- HEADING AREA -->
           <p class="slds-text-title_caps slds-line-height_reset"><lightning-button variant="base" label={recordName} title={recordName} onclick={navigateToAccount}></lightning-button>        </p>
           <h1 class="slds-page-header__title slds-m-right_small slds-align-middle slds-truncate"  title="Asset Line Items">Active Assets</h1>
           <!-- / HEADING AREA -->
           </div>
           <!-- ACTION BUTTONS -->
           <template if:true={showActionButton}>
               <div class="slds-col slds-no-flex slds-grid slds-align-top">
                   <div class="slds-button-group" role="group">
                       <lightning-button variant="brand"
                       label="Create Order"
                       title="Create Order"
                       onclick={openModal}
                       class="slds-m-left_x-small"></lightning-button>  
                   </div>
               </div>   
           </template>                   
           <!-- / ACTION BUTTONS -->
       </div>
       <!-- / LAYOUT GRID -->
       <!-- PAGE HEADER DETAIL ROW -->
       <!-- / PAGE HEADER DETAIL ROW -->
   </div>
   <!-- / PAGE HEADER -->    
   <template if:true={showTable}>
        <c-apts-lwc-datatable records={allRecords} 
           total-records={allRecords.length} 
           columns = {columns}
           key-field="Id"
           show-search-box="true"            
           max-row-selection="1"
           onpaginatorchange={handlePaginatorChange}
           onsetselectedrecords={handleAllSelectedRows}>
        </c-apts-lwc-datatable>          
   </template>
  <!-- Action Selection Modal -->         
  <template if:true={bShowActionModal}>
     <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open  slds-modal_large">
        <div class="slds-modal__container">
           <!-- modal header  -->
           <header class="slds-modal__header">
              <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close" onclick={closeModal}>
                 <lightning-icon icon-name="utility:close"
                    alternative-text="close"
                    variant="inverse"
                    size="small" ></lightning-icon>
                 <span class="slds-assistive-text">Close</span>
              </button>
              <h2 id="modal-heading-01" class="slds-text-heading_medium slds-hyphenate">{selectedAsset.serialNumber}</h2>
           </header>
           <!-- modal body  -->
           <div class="slds-modal__content slds-p-around_medium" id="modal-content-id-1">
            <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close" onclick={closeModal}>
                <lightning-icon icon-name="utility:close"
                   alternative-text="close"
                   variant="inverse"
                   size="small" ></lightning-icon>
                <span class="slds-assistive-text">Close</span>
             </button>
           </div> 
           <!-- modal footer -->
           
        </div>
     </section>
     <div class="slds-backdrop slds-backdrop_open"></div>
  </template>  
 
 
   <!-- Change Asset Modal --> 
  <template if:true={bShowChangeAssetModal}>
   <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open slds-modal_large">
      <div class="slds-modal__container">
         <!-- modal header  -->
         <header class="slds-modal__header">
            <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse slds-button__icon_large" title="Close" onclick={closeChangeAssetModal}>
               <lightning-icon icon-name="utility:close"
                  alternative-text="close"
                  variant="inverse"
                  size="small" ></lightning-icon>
               <span class="slds-assistive-text">Close</span>
            </button>
            <h2  class="slds-text-heading_medium slds-hyphenate">{selectedAsset.serialNumber}</h2>
         </header>
         <!-- modal body  -->
         <div class="slds-modal__content slds-p-around_medium" > 
             <c-apts-asset-conversion-order selected-actions={selectedActions} selected-account-id={recordId} 
                                              selected-asset-id={selectedAsset.Id} onselectedassets={handleSelectedAssets} 
                                              ontermination={handleTermination} onchangedbundleattributes={handleBundleAttributes} 
                                              credit={checkCredit} onselected={handleCreditCheck}
                                              ></c-apts-asset-conversion-order>
         </div>
         <!-- modal footer -->
         <footer class="slds-modal__footer">
             <template if:true={assetRecords}>
                 <button class="slds-button slds-button_brand" onclick={createOrder} disabled={orderStatus} > Submit
                    <span class="exampleHolder" if:true={orderStatus}><lightning-spinner alternative-text="Order Inprogress" variant="brand" size="small"></lightning-spinner></span>
                 </button>
             </template>
             <template if:false={isStatusScreen}>
            <button class="slds-button slds-button_neutral" onclick={closeChangeAssetModal}>Cancel</button>
           </template>
           <template if:true={isStatusScreen}>
              <button class="slds-button slds-button_neutral" onclick={closeChangeAssetModal}>Close</button>
             </template>
         </footer>
      </div>
   </section>
   <div class="slds-backdrop slds-backdrop_open"></div>
  </template>    
 
 </template>